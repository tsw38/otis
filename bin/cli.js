#!/usr/bin/env node










parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"commands.js":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.SCOPE=exports.MODE=exports.showConfig=exports.showHelp=exports.test=exports.MODES=exports.SCOPES=void 0;const e=require("minimist")(process.argv.slice(2)),t={test:"test"},o={e2e:["-e","--e2e"],help:["-h","--help"],unit:["-u","--unit"],watch:["-w","--watch"]},s={e2e:"e2e",unit:"unit",both:"both",none:"none"};exports.SCOPES=s;const n={watch:"watch"};exports.MODES=n;const p=t=>e[t.replace(/\-/g,"")],r=e._.includes(t.test);exports.test=r;const c=o.e2e.some(p),i=o.unit.some(p),h=o.watch.some(p),x=o.help.some(p);exports.showHelp=x;const u=e.config;exports.showConfig=u;const w=h?n.watch:"";exports.MODE=w;const l=c&&i?s.both:c&&!i?s.e2e:!c&&i?s.unit:s.none;exports.SCOPE=l;
},{}],"../../jest.config.json":[function(require,module,exports) {
module.exports={clearMocks:!0,resetMocks:!0,moduleDirectories:["node_modules","<rootDir>/src/js/","<rootDir>/src","<rootDir>/__test__","<rootDir>"],moduleFileExtensions:["js","jsx","json"],roots:["<rootDir>/node_modules","<rootDir>/src/js/","<rootDir>/src","<rootDir>"],modulePaths:["<rootDir>/node_modules","<rootDir>/src/js/","<rootDir>/src","<rootDir>"],moduleNameMapper:{"\\.(svg|css)$":"@tsw38/otis/lib/modules/map-to-string","\\.scss$":"identity-obj-proxy"},globalSetup:"@tsw38/otis/lib/modules/global-setup",setupFiles:["jest-date-mock"],setupFilesAfterEnv:["jest-extended","jest-chain","@testing-library/jest-dom/extend-expect"],reporters:["default"],coverageDirectory:"coverage",collectCoverageFrom:["<rootDir>/src/**/*.{js,jsx,ts,tsx}"],coverageReporters:["json","lcov","text-summary","json-summary"],watchPlugins:["jest-watch-typeahead/filename","jest-watch-typeahead/testname"],testPathIgnorePatterns:["cypress/*","/src/.+(int|e2e).(spec|test).(t|j)s(x)?"]};
},{}],"get-jest-config-path.js":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getJestConfig=void 0;var e=t(require("fs"));function t(e){return e&&e.__esModule?e:{default:e}}const s=()=>{const t=process.env.PWD,s=`${t}/jest.config.json`;return e.default.existsSync(s)?s:`${t}/package.json`};exports.getJestConfig=s;
},{}],"merge-jest-configs.js":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeJestConfigs=void 0;var e=r(require("../../jest.config.json")),t=require("./get-jest-config-path");function r(e){return e&&e.__esModule?e:{default:e}}const s=require("fs"),o=require("deepmerge"),i=require("clone-deep"),n=()=>new Promise(r=>{const n=process.env.PWD,c=(0,t.getJestConfig)(),f=c.includes("package.json");let u=e.default;if(s.existsSync(c)){const t=JSON.parse(s.readFileSync(c,"utf-8"));u=o({...e.default,roots:e.default.roots.filter(e=>s.existsSync(`${n}/${e.replace("<rootDir>","")}`))},{...i(f?t.jest:t),rootDir:n})}s.writeFileSync(`${process.env.TMPDIR}/jest.config.json`,JSON.stringify(u),"utf-8"),r({})});exports.mergeJestConfigs=n;
},{"../../jest.config.json":"../../jest.config.json","./get-jest-config-path":"get-jest-config-path.js"}],"unit.js":[function(require,module,exports) {
const{fork:e}=require("child_process"),{log:s}=require("@tsw38/custom-logger"),{mergeJestConfigs:t}=require("./merge-jest-configs"),{PWD:n}=process.env,i=`${n}/node_modules/.bin/jest`,o=`${process.env.TMPDIR}jest.config.json`,r=async n=>{await t();const r=e(i,[n?"--watch":"--coverage",`--config=${o}`],{env:{...process.env,NODE_ENV:"test",JEST_TEST:!0,...n?{DEBUG_PRINT_LIMIT:-1}:{}}});return new Promise((e,t)=>{r.on("exit",n=>{1===n?t(n):(s("Unit Tests Passed",{type:"success",header:"Otis - Unit Tests"}),e(n))})}).catch(e=>(s("Unit Tests Failed",{type:"error",header:"Otis - Unit Tests"}),e))},c=async()=>(s("Running Unit Tests",{header:"Otis - Unit Tests"}),await r()),a=async()=>(s("Watching Unit Tests",{header:"Otis - Unit Tests"}),await r(!0)),T=()=>t().then(()=>e(i,[`--config=${o}`,"--showConfig"]));module.exports={runUnitTests:c,showJestConfig:T,runUnitTestsWatch:a};
},{"./merge-jest-configs":"merge-jest-configs.js"}],"../../cypress.json":[function(require,module,exports) {
module.exports={viewportWidth:1080,viewportHeight:1080,video:!0,nodeVersion:"system",screenshotOnRunFailure:!0,integrationFolder:"cypress/e2e",fixturesFolder:"__test__/fixtures"};
},{}],"get-cypress-config-path.js":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.getCypressConfigPath=void 0;var e=s(require("fs"));function s(e){return e&&e.__esModule?e:{default:e}}const t=()=>{const s=process.env.PWD,t=`${s}/cypress.json`;return e.default.existsSync(t)?t:`${s}/package.json`};exports.getCypressConfigPath=t;
},{}],"merge-cypress-configs.js":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.mergeCypressConfigs=void 0;var e=r(require("../../cypress.json")),s=require("./get-cypress-config-path");function r(e){return e&&e.__esModule?e:{default:e}}const t=require("fs"),o=require("deepmerge"),i=require("clone-deep"),n=()=>new Promise(r=>{const n=(0,s.getCypressConfigPath)(),u=n.includes("package.json");let c=e.default;if(t.existsSync(n)){const s=JSON.parse(t.readFileSync(n,"utf-8"));c=o(e.default,i(u?s.cypress:s))}r(c)});exports.mergeCypressConfigs=n;
},{"../../cypress.json":"../../cypress.json","./get-cypress-config-path":"get-cypress-config-path.js"}],"e2e.js":[function(require,module,exports) {
const e=require("fs"),s=require("glob"),{fork:t}=require("child_process"),{log:r}=require("@tsw38/custom-logger"),i=require("minimist")(process.argv.slice(2)),{mergeCypressConfigs:n}=require("./merge-cypress-configs"),{PWD:o}=process.env,a=`${o}/node_modules/.bin/cypress`,c="./node_modules/.bin/start-server-and-test",l=({baseUrl:e})=>/local.+\:\d{4,}/.test(e),d=e=>Object.entries(e).map(([e,s])=>`-c${e}=${JSON.stringify(s)}`).join(" "),E=async E=>{const g=await n();let u=!1;if(!(u=g.testFiles?Boolean(s.sync(`${o}/${g.testFiles}`).length):Boolean(e.readdirSync(`${o}/${g.integrationFolder}`).length)))return void r(`No E2E tests found ${Boolean(g.testFiles)?`with pattern: ${g.testFiles}`:`in directory: ${o}/${g.integrationFolder}`}`,{header:"Otis - E2E Tests"});const h=l(g),$=E?"open":"run",p=`${d(g)}`;let y;return y=h?t(c,[i["start-command"]||"start",(g.baseUrl||"").split(":")[2]||3e3,`${a} ${$} ${p}`]):t(a,[$,p]),new Promise((e,s)=>{y.on("exit",t=>{1===t?s():(r("E2E Tests Passed",{type:"success",header:"Otis - E2E Tests"}),e())})}).catch(e=>{r("E2E Tests Failed",{type:"error",header:"Otis - E2E Tests"})})},g=async()=>{r("Running E2E Tests",{header:"Otis - E2E Tests"}),await E()},u=async()=>{r("Watching E2E Tests",{header:"Otis - E2E Tests"}),await E(!0)},h=()=>{n().then(({config:e})=>{r(JSON.stringify(e,null,2),{header:"Otis"})})};module.exports={runE2ETests:g,runE2ETestsWatch:u,showCypressConfig:h};
},{"./merge-cypress-configs":"merge-cypress-configs.js"}],"help.js":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const e=require("command-line-usage"),t=[{header:"OTIS",content:"An opinionated testing interface system"},{header:"Available Commands",content:[{name:"test",summary:"Runs the testing suite"},{name:"--help",summary:"Seems a bit self explanatory"}].map(({name:e,summary:t})=>({name:e,summary:t}))},{header:"Command: 'otis test'",optionList:[{name:"unit",alias:"u",typeLabel:"    bool",description:"Runs the jest unit tests looking for any .spec.js or .spec.jsx file"},{name:"e2e",alias:"e",typeLabel:"     bool",description:"Runs the cypress end to end tests looking for any .e2e.js or .e2e.jsx file"},{name:"watch",alias:"w",typeLabel:"   bool",description:"Used in conjunction with the unit/e2e command to run jest/cypress in watch/open mode"},{name:"start-command",typeLabel:"string",description:"(optional) flag to pass a custom start command other than your projects `npm start` for running E2E tests against"}]},{header:"Command: 'otis (-u | -e)'",optionList:[{name:"config",typeLabel:"bool",description:"Prints the extended jest/cypress configuration for your tests"}]}];var s=()=>console.log(e(t));exports.default=s;
},{}],"index.js":[function(require,module,exports) {

"use strict";var e=require("./commands.js"),t=require("./unit"),r=require("./e2e"),s=i(require("./help"));function i(e){return e&&e.__esModule?e:{default:e}}const{log:n}=require("@tsw38/custom-logger");switch(e.SCOPE){case e.SCOPES.unit:if(e.test&&e.MODE===e.MODES.watch){(0,t.runUnitTestsWatch)();break}if(e.test){(0,t.runUnitTests)();break}if(e.showConfig){(0,t.showJestConfig)();break}break;case e.SCOPES.e2e:if(e.test&&e.MODE===e.MODES.watch){(0,r.runE2ETestsWatch)();break}if(e.test){(0,r.runE2ETests)();break}if(e.showConfig){(0,r.showCypressConfig)();break}case e.SCOPES.none:case e.SCOPES.both:default:if(e.test){(0,t.runUnitTests)().then(e=>{if(e)throw new Error("Unit Tests Failed")}).then(r.runE2ETests).then(e=>{if(e)throw new Error("E2E Tests Failed")}).catch(e=>{n(e.message||e,{type:"error",header:"Otis - Error"})});break}if(e.showHelp){(0,s.default)();break}}
},{"./commands.js":"commands.js","./unit":"unit.js","./e2e":"e2e.js","./help":"help.js"}]},{},["index.js"], null)